name: RustDesk Screenshot

on:
  workflow_dispatch:

jobs:
  rustdesk-screenshot:
    runs-on: windows-latest
    timeout-minutes: 360  # 6 hours

    steps:
      - name: Download & Install AutoHotkey v2
        run: |
          $ahkUrl = "https://www.autohotkey.com/download/ahk-v2.exe"
          $ahkExe = "$env:TEMP\ahk_v2.exe"
          Invoke-WebRequest -Uri $ahkUrl -OutFile $ahkExe
          Start-Process -FilePath $ahkExe -ArgumentList "/silent" -Wait

      - name: Create script.ahk
        run: |
          $scriptPath = "$env:TEMP\script.ahk"
          Set-Content -Path $scriptPath -Value @"
Sleep 3000
Send "ffbewafa709@gmail.com"
Sleep 1000
Send "{Tab}"
Sleep 1000
Send "Hamza@123456"
Sleep 1000
Send "{Enter}"
Sleep 30000
Send "{Enter}"
"@
          echo "AHK_SCRIPT=$scriptPath" >> $env:GITHUB_ENV

      - name: Download & Install Parsec
        run: |
          $parsecUrl = "https://builds.parsec.app/package/parsec-windows.exe"
          $parsecExe = "$env:TEMP\parsec.exe"
          Invoke-WebRequest -Uri $parsecUrl -OutFile $parsecExe
          Start-Process -FilePath $parsecExe -ArgumentList "/S" -Wait
          Start-Sleep -Seconds 20

      - name: Run AHK script to auto-login Parsec
        run: |
          $ahkRunner = "C:\Program Files\AutoHotkey\UX\AutoHotkeyUX.exe"
          & "$ahkRunner" "$env:AHK_SCRIPT"

      - name: Keep workflow alive for 6 hours
        run: |
          Write-Host "=== Workflow Running 6 Hours ==="
          $start = Get-Date
          while ((New-TimeSpan -Start $start -End (Get-Date)).TotalHours -lt 6) {
              Write-Host "[$(Get-Date)] Still running..."
              Start-Sleep -Seconds 300
          }
          Write-Host "Completed 6 hours."
